<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <title>TileLite control panel</title>
  <link rel="stylesheet" href="http://openlayers.org/en/v3.15.1/css/ol.css" type="text/css">
  <script type="text/javascript" src="controlpanel.js"></script>
  <script src="http://openlayers.org/en/v3.15.1/build/ol.js"></script>
</head>

<body>
  <div id="map" class="map"></div>
  <div id="elm"></div>
</body>

<script type="text/javascript">
var root = document.getElementById("elm");
var app = Elm.ControlPanel.embed(root);

var raster = new ol.layer.Tile({
  source: new ol.source.MapQuest({layer: 'sat'})
});

var source = new ol.source.Vector();

var vector = new ol.layer.Vector({
  source: source,
  style: new ol.style.Style({
    fill: new ol.style.Fill({
      color: 'rgba(255, 255, 255, 0.2)'
    }),
    stroke: new ol.style.Stroke({
      color: '#ffcc33',
      width: 2
    }),
    image: new ol.style.Circle({
      radius: 7,
      fill: new ol.style.Fill({
        color: '#ffcc33'
      })
    })
  })
});

var map = new ol.Map({
  layers: [raster, vector],
  target: 'map',
  view: new ol.View({
    center: ol.proj.fromLonLat([24.747583, 59.461970]),
    zoom: 7
  })
});

function addInteraction() {
  var type = 'Polygon';
  draw = new ol.interaction.Draw({
    source: source,
    type: type,
    style: new ol.style.Style({
      fill: new ol.style.Fill({
        color: 'rgba(255, 255, 255, 0.2)'
      }),
      stroke: new ol.style.Stroke({
        color: 'rgba(200, 200, 200, 0.5)',
        lineDash: [10, 10],
        width: 2
      }),
      image: new ol.style.Circle({
        radius: 5,
        stroke: new ol.style.Stroke({
          color: 'rgba(255, 255, 255, 0.7)'
        }),
        fill: new ol.style.Fill({
          color: 'rgba(255, 255, 255, 0.2)'
        })
      })
    })
  });
  map.addInteraction(draw);

  draw.on('drawend', function(evt) {
    var coords = evt.feature.getGeometry().getCoordinates()[0].map(function(c) {
      return ol.proj.toLonLat(c);
    }).slice(0, -1);
    source.clear();
    console.log(coords);
    app.ports.bounds.send(coords);
  });
}

addInteraction();
</script>

</html>
